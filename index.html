<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>SIN FARM â€” Ğ¤ĞµÑ€Ğ¼Ğ° Ğ“Ñ€ĞµÑ…Ğ¾Ğ²</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{
  width:100%;height:100%;background:#000;
  display:flex;align-items:center;justify-content:center;
  overflow:hidden;touch-action:none;
}
#scaler{position:relative;transform-origin:top left;}
canvas{display:block;image-rendering:pixelated;}
#touch-ui{
  position:absolute;top:0;left:0;width:100%;height:100%;
  pointer-events:none;user-select:none;
}
#joy-zone{
  position:absolute;left:12px;bottom:108px;
  width:126px;height:126px;border-radius:50%;
  background:rgba(80,40,10,0.18);border:2px solid rgba(120,60,20,0.35);
  pointer-events:all;touch-action:none;
}
#joy-knob{
  position:absolute;left:50%;top:50%;width:50px;height:50px;margin:-25px 0 0 -25px;
  border-radius:50%;
  background:radial-gradient(circle at 35% 35%,#5a3010,#1a0808);
  border:2px solid #7a3010;box-shadow:0 0 12px rgba(180,80,20,0.4);
  pointer-events:none;transition:transform 0.04s;
}
/* Right action buttons */
#btn-atk{
  position:absolute;right:14px;bottom:155px;width:66px;height:66px;border-radius:50%;
  background:radial-gradient(circle at 35% 35%,#6a0808,#250303);
  border:2px solid #c02020;box-shadow:0 0 14px rgba(200,30,30,0.5);
  pointer-events:all;display:flex;align-items:center;justify-content:center;
  font-size:26px;cursor:pointer;
}
#btn-e{
  position:absolute;right:96px;bottom:108px;width:56px;height:56px;border-radius:50%;
  background:radial-gradient(circle at 35% 35%,#0a2a0a,#060e06);
  border:2px solid #30a030;box-shadow:0 0 12px rgba(40,160,40,0.35);
  pointer-events:all;display:flex;align-items:center;justify-content:center;
  font-size:11px;color:#60d060;font-family:'Courier New',monospace;
  text-align:center;line-height:1.3;cursor:pointer;
}
#btn-shop,#btn-shop-close{
  position:absolute;right:14px;bottom:78px;width:58px;height:58px;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  pointer-events:all;cursor:pointer;font-family:'Courier New',monospace;
}
#btn-shop{
  background:radial-gradient(circle at 35% 35%,#4a3a08,#120d02);
  border:2px solid #c8a020;box-shadow:0 0 12px rgba(200,160,30,0.35);font-size:22px;
}
#btn-shop-close{
  display:none;
  background:radial-gradient(circle at 35% 35%,#4a0808,#120202);
  border:2px solid #c82020;box-shadow:0 0 12px rgba(200,30,30,0.35);
  font-size:12px;color:#c86060;text-align:center;line-height:1.3;
}
/* Seed bar */
#seed-bar{
  position:absolute;bottom:10px;left:152px;right:86px;
  display:flex;gap:3px;justify-content:center;pointer-events:all;
}
.seed-btn{
  flex:1;max-width:52px;min-width:32px;height:46px;border-radius:8px;
  background:#0e0805;border:1.5px solid #2a1a08;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  font-size:15px;line-height:1;cursor:pointer;pointer-events:all;touch-action:none;
}
.seed-btn.locked{opacity:0.28;}
.seed-btn.active{border-color:#c8a020;background:#1e1408;}
.seed-btn span{font-size:8px;color:#6a5a3a;margin-top:2px;font-family:'Courier New',monospace;}
/* Shop touch controls */
#shop-touch{
  display:none;position:absolute;
  bottom:56px;left:50%;transform:translateX(-50%);
  gap:6px;
}
#shop-touch.visible{display:flex;}
#btn-buy,#btn-sell,#btn-up,#btn-dn{
  width:72px;height:44px;border-radius:8px;
  display:flex;align-items:center;justify-content:center;
  font-size:11px;font-family:'Courier New',monospace;
  pointer-events:all;cursor:pointer;border:1.5px solid;
}
#btn-buy{background:#081408;border-color:#30a030;color:#60d060;}
#btn-sell{background:#180808;border-color:#a03020;color:#d06040;}
#btn-up{background:#080818;border-color:#3040a0;color:#6080d0;}
#btn-dn{background:#080818;border-color:#3040a0;color:#6080d0;}
</style>
</head>
<body>
<div id="scaler">
  <canvas id="c"></canvas>
  <div id="touch-ui">
    <div id="joy-zone"><div id="joy-knob"></div></div>
    <div id="btn-atk">ğŸª“</div>
    <div id="btn-e">E<br>Ğ´ĞµĞ¹ÑÑ‚Ğ².</div>
    <div id="btn-shop">ğŸª</div>
    <div id="btn-shop-close">âœ–<br>Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</div>
    <div id="seed-bar"></div>
    <div id="shop-touch">
      <div id="btn-up">â–² Ğ²Ğ²ĞµÑ€Ñ…</div>
      <div id="btn-dn">â–¼ Ğ²Ğ½Ğ¸Ğ·</div>
      <div id="btn-buy">B ĞºÑƒĞ¿Ğ¸Ñ‚ÑŒ</div>
      <div id="btn-sell">V Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ</div>
    </div>
  </div>
</div>
<script>
'use strict';
const C=document.getElementById('c');
const ctx=C.getContext('2d');
const GW=768,GH=528,TS=48;
C.width=GW;C.height=GH;

// â”€â”€ Responsive scale â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const scaler=document.getElementById('scaler');
function resize(){
  const sc=Math.min(window.innerWidth/GW,window.innerHeight/GH);
  scaler.style.width=GW+'px';scaler.style.height=GH+'px';
  scaler.style.transform=`scale(${sc})`;
  scaler.style.marginLeft=((window.innerWidth-GW*sc)/2)+'px';
  scaler.style.marginTop=((window.innerHeight-GH*sc)/2)+'px';
}
resize();window.addEventListener('resize',resize);

// â”€â”€ Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SINS=[
  {id:0,name:'Ğ›Ğ•ĞĞ¬',       en:'SLOTH',   color:'#7a6655',dark:'#3a2820',glow:'#9a8060',seedCost:15,  sellPrice:40,  growTime:18, sym:'ğŸ’¤'},
  {id:1,name:'Ğ§Ğ Ğ•Ğ’ĞĞ£Ğ“.',  en:'GLUTTONY',color:'#9b4a18',dark:'#4a200a',glow:'#d06020',seedCost:40,  sellPrice:105, growTime:30, sym:'ğŸ—'},
  {id:2,name:'Ğ–ĞĞ”ĞĞĞ¡Ğ¢Ğ¬',  en:'GREED',   color:'#c0900a',dark:'#604500',glow:'#f0b020',seedCost:90,  sellPrice:240, growTime:45, sym:'ğŸ’°'},
  {id:3,name:'ĞŸĞĞ¥ĞĞ¢Ğ¬',    en:'LUST',    color:'#901020',dark:'#480010',glow:'#e03050',seedCost:220, sellPrice:580, growTime:65, sym:'ğŸŒ¹'},
  {id:4,name:'Ğ—ĞĞ’Ğ˜Ğ¡Ğ¢Ğ¬',   en:'ENVY',    color:'#2a6020',dark:'#103010',glow:'#40a030',seedCost:540, sellPrice:1400,growTime:90, sym:'ğŸ'},
  {id:5,name:'Ğ“ĞĞ•Ğ’',      en:'WRATH',   color:'#c82000',dark:'#600800',glow:'#ff4010',seedCost:1300,sellPrice:3300,growTime:120,sym:'ğŸ”¥'},
  {id:6,name:'Ğ“ĞĞ Ğ”Ğ«ĞĞ¯',   en:'PRIDE',   color:'#5a0a90',dark:'#220040',glow:'#9030e0',seedCost:3000,sellPrice:7500,growTime:160,sym:'ğŸ‘‘'},
];
const MAP=[
  [3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],
  [3,2,2,2,3,1,1,1,1,0,1,1,1,1,3,3],
  [3,2,2,2,3,1,1,1,1,0,1,1,1,1,3,3],
  [3,2,2,2,3,1,1,1,1,0,1,1,1,1,3,3],
  [3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],
  [3,0,0,0,0,1,1,1,1,0,1,1,1,1,0,3],
  [3,0,0,0,0,1,1,1,1,0,1,1,1,1,0,3],
  [3,0,0,0,0,1,1,1,1,0,1,1,1,1,0,3],
  [3,0,0,0,0,1,1,1,1,0,1,1,1,1,0,3],
  [3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],
  [3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],
];
const ROWS=11,COLS=16;
const PLOT_COORDS=[];
for(let r=1;r<=3;r++){for(let c=5;c<=8;c++)PLOT_COORDS.push([c,r]);for(let c=10;c<=13;c++)PLOT_COORDS.push([c,r]);}
for(let r=5;r<=8;r++){for(let c=5;c<=8;c++)PLOT_COORDS.push([c,r]);for(let c=10;c<=13;c++)PLOT_COORDS.push([c,r]);}
const ETYPES=[
  {name:'Ğ“Ğ¾Ğ»ÑƒĞ±ÑŒ',  maxHp:1,speed:0.75,reward:8, color:'#e0e0d8',size:12,cropDmg:8, pdmg:1,ulk:0},
  {name:'Ğ¯Ğ³Ğ½Ñ‘Ğ½Ğ¾Ğº', maxHp:2,speed:0.95,reward:18,color:'#d4c080',size:15,cropDmg:14,pdmg:1,ulk:1},
  {name:'Ğ¡Ñ‚Ñ€Ğ°Ğ¶',  maxHp:4,speed:1.15,reward:35,color:'#b0c4e0',size:18,cropDmg:20,pdmg:2,ulk:3},
];

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const gs={
  coins:50,seeds:new Array(7).fill(0),discovered:new Array(7).fill(false),
  plots:PLOT_COORDS.map(([x,y])=>({x,y,sinId:-1,plantedAt:0,stage:0,health:100})),
  player:{x:2.5*TS,y:6.5*TS,hp:10,maxHp:10,facing:0,atkTimer:0,atkOn:false,invTimer:0,regenT:0,dead:false,sel:0},
  enemies:[],
  rain:Array.from({length:190},()=>({x:Math.random()*GW,y:Math.random()*GH,s:1.5+Math.random()*3,l:8+Math.random()*20,o:0.05+Math.random()*0.12})),
  shop:{open:false,sel:0},notify:null,spawnT:0,t:0,win:false,
};

// â”€â”€ Joystick â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const joy={active:false,id:-1,bx:0,by:0,dx:0,dy:0};
const joyZone=document.getElementById('joy-zone');
const joyKnob=document.getElementById('joy-knob');
const JR=62;
function joyStart(cx,cy){const r=joyZone.getBoundingClientRect();joy.bx=r.left+r.width/2;joy.by=r.top+r.height/2;joy.active=true;joyMove(cx,cy);}
function joyMove(cx,cy){if(!joy.active)return;let dx=cx-joy.bx,dy=cy-joy.by;const d=Math.hypot(dx,dy);if(d>JR){dx=dx/d*JR;dy=dy/d*JR;}joy.dx=dx/JR;joy.dy=dy/JR;joyKnob.style.transform=`translate(${dx}px,${dy}px)`;}
function joyEnd(){joy.active=false;joy.dx=0;joy.dy=0;joyKnob.style.transform='';}
joyZone.addEventListener('touchstart',e=>{e.preventDefault();const t=e.changedTouches[0];joy.id=t.identifier;joyStart(t.clientX,t.clientY);},{passive:false});
document.addEventListener('touchmove',e=>{for(const t of e.changedTouches)if(t.identifier===joy.id){e.preventDefault();joyMove(t.clientX,t.clientY);return;}},{passive:false});
document.addEventListener('touchend',e=>{for(const t of e.changedTouches)if(t.identifier===joy.id){joyEnd();return;}});

// â”€â”€ Keyboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const keys={};
document.addEventListener('keydown',e=>{
  keys[e.code]=true;
  if(e.code==='Tab'){e.preventDefault();toggleShop();}
  if(e.code==='Space'){e.preventDefault();attack();}
  if(e.code==='KeyE')interact();
  if(gs.shop.open){
    if(e.code==='ArrowUp'||e.code==='KeyW')gs.shop.sel=Math.max(0,gs.shop.sel-1);
    if(e.code==='ArrowDown'||e.code==='KeyS')gs.shop.sel=Math.min(6,gs.shop.sel+1);
    if(e.code==='KeyB')buyItem();if(e.code==='KeyV')sellItem();
  }
  for(let i=1;i<=7;i++)if(e.code==='Digit'+i)selectSeed(i-1);
});
document.addEventListener('keyup',e=>keys[e.code]=false);

// â”€â”€ Touch buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function tbind(id,fn){const el=document.getElementById(id);['touchstart','mousedown'].forEach(ev=>el.addEventListener(ev,e=>{e.preventDefault();fn();},{passive:false}));}
function toggleShop(){if(!gs.player.dead&&!gs.win){gs.shop.open=!gs.shop.open;updateShopUI();}}
function updateShopUI(){
  const o=gs.shop.open;
  document.getElementById('btn-shop').style.display=o?'none':'flex';
  document.getElementById('btn-shop-close').style.display=o?'flex':'none';
  document.getElementById('shop-touch').classList.toggle('visible',o);
}
tbind('btn-atk',attack);tbind('btn-e',interact);tbind('btn-shop',toggleShop);tbind('btn-shop-close',toggleShop);
tbind('btn-buy',buyItem);tbind('btn-sell',sellItem);
tbind('btn-up',()=>{gs.shop.sel=Math.max(0,gs.shop.sel-1);});
tbind('btn-dn',()=>{gs.shop.sel=Math.min(6,gs.shop.sel+1);});

// â”€â”€ Seed bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const seedBar=document.getElementById('seed-bar');
function buildSeedBar(){
  seedBar.innerHTML='';
  for(let i=0;i<7;i++){
    const b=document.createElement('div');
    b.className='seed-btn'+(i===gs.player.sel?' active':'')+(unlocked(i)?'':' locked');
    b.innerHTML=SINS[i].sym+'<span>Ã—'+gs.seeds[i]+'</span>';
    ['touchstart','mousedown'].forEach(ev=>b.addEventListener(ev,e=>{e.preventDefault();selectSeed(i);},{passive:false}));
    seedBar.appendChild(b);
  }
}
function updateSeedBar(){const bs=seedBar.querySelectorAll('.seed-btn');bs.forEach((b,i)=>{b.className='seed-btn'+(i===gs.player.sel?' active':'')+(unlocked(i)?'':' locked');b.innerHTML=SINS[i].sym+'<span>Ã—'+gs.seeds[i]+'</span>';});}
buildSeedBar();
function selectSeed(i){gs.player.sel=i;updateSeedBar();}

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function unlocked(id){return id===0||gs.discovered[id-1];}
function discoveredCount(){return gs.discovered.filter(Boolean).length;}
function notify(sinId){gs.notify={sinId,start:Date.now()};setTimeout(()=>{if(gs.notify?.sinId===sinId)gs.notify=null;},4000);}

// â”€â”€ Logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function attack(){
  const p=gs.player;if(gs.shop.open||p.dead)return;
  const now=Date.now();if(now-p.atkTimer<450)return;
  p.atkTimer=now;p.atkOn=true;setTimeout(()=>p.atkOn=false,220);
  const dirs=[[1,0],[0,1],[-1,0],[0,-1]];const[ddx,ddy]=dirs[p.facing];
  const ax=p.x+ddx*30,ay=p.y+ddy*30;
  gs.enemies=gs.enemies.filter(e=>{if(Math.hypot(e.x-ax,e.y-ay)<52){e.hp-=2;e.hit=Date.now();if(e.hp<=0){gs.coins+=e.reward;return false;}}return true;});
}
function interact(){
  if(gs.shop.open||gs.player.dead)return;
  const p=gs.player,px=Math.floor(p.x/TS),py=Math.floor(p.y/TS);
  for(const pl of gs.plots){
    if(Math.abs(pl.x-px)<=1&&Math.abs(pl.y-py)<=1){
      if(pl.stage===3){const s=SINS[pl.sinId];gs.coins+=Math.floor(s.sellPrice*(pl.health/100));if(!gs.discovered[pl.sinId]){gs.discovered[pl.sinId]=true;notify(pl.sinId);buildSeedBar();}if(gs.discovered.every(Boolean))setTimeout(()=>gs.win=true,2500);pl.stage=0;pl.sinId=-1;pl.health=100;return;}
      if(pl.stage===0){
        const sid=p.sel;
        if(unlocked(sid)&&gs.seeds[sid]>0){pl.sinId=sid;pl.stage=1;pl.plantedAt=Date.now();pl.health=100;gs.seeds[sid]--;updateSeedBar();return;}
        for(let i=0;i<7;i++){if(unlocked(i)&&gs.seeds[i]>0){pl.sinId=i;pl.stage=1;pl.plantedAt=Date.now();pl.health=100;gs.seeds[i]--;updateSeedBar();return;}}
      }
      return;
    }
  }
}
function buyItem(){const id=gs.shop.sel;if(!unlocked(id))return;if(gs.coins>=SINS[id].seedCost){gs.coins-=SINS[id].seedCost;gs.seeds[id]++;updateSeedBar();}}
function sellItem(){const id=gs.shop.sel;if(gs.seeds[id]>0){gs.seeds[id]--;gs.coins+=Math.floor(SINS[id].seedCost*0.5);updateSeedBar();}}
function isWall(px,py){const m=10;for(const[x,y]of[[px-m,py-m],[px+m,py-m],[px-m,py+m],[px+m,py+m]]){const tc=Math.floor(x/TS),tr=Math.floor(y/TS);if(tr<0||tr>=ROWS||tc<0||tc>=COLS||MAP[tr][tc]===3||MAP[tr][tc]===2)return true;}return false;}

function updatePlayer(dt){
  const p=gs.player;if(p.dead||gs.shop.open)return;
  const sp=2.6;let dx=0,dy=0;
  if(keys['KeyA']||keys['ArrowLeft']){dx-=sp;if(!joy.active)p.facing=2;}
  if(keys['KeyD']||keys['ArrowRight']){dx+=sp;if(!joy.active)p.facing=0;}
  if(keys['KeyW']||keys['ArrowUp']){dy-=sp;if(!joy.active)p.facing=3;}
  if(keys['KeyS']||keys['ArrowDown']){dy+=sp;if(!joy.active)p.facing=1;}
  if(joy.active){dx=joy.dx*sp;dy=joy.dy*sp;if(Math.abs(joy.dx)>0.15)p.facing=joy.dx>0?0:2;else if(Math.abs(joy.dy)>0.15)p.facing=joy.dy>0?1:3;}
  if(dx&&dy){dx*=0.707;dy*=0.707;}
  if(!isWall(p.x+dx,p.y))p.x+=dx;
  if(!isWall(p.x,p.y+dy))p.y+=dy;
  p.x=Math.max(TS+12,Math.min(GW-TS-12,p.x));p.y=Math.max(TS+12,Math.min(GH-TS-12,p.y));
  if(p.invTimer>0)p.invTimer-=dt;
  p.regenT+=dt;if(p.regenT>5000){p.regenT=0;p.hp=Math.min(p.maxHp,p.hp+1);}
}
function updatePlots(){const now=Date.now();for(const p of gs.plots){if(p.stage<1||p.stage>=3)continue;const el=(now-p.plantedAt)/1000,gt=SINS[p.sinId].growTime;if(el>=gt)p.stage=3;else if(el>=gt*0.5)p.stage=2;else p.stage=1;}}
function updateEnemies(){
  const now=Date.now(),p=gs.player;
  for(const e of gs.enemies){
    let tgt=null,td=9999;
    for(const pl of gs.plots){if(pl.stage<1)continue;const d=Math.hypot(pl.x*TS+24-e.x,pl.y*TS+24-e.y);if(d<td){td=d;tgt=pl;}}
    if(tgt&&td<320){const tx=tgt.x*TS+24,ty=tgt.y*TS+24,d=Math.hypot(tx-e.x,ty-e.y);if(d>22){e.x+=(tx-e.x)/d*e.speed;e.y+=(ty-e.y)/d*e.speed;}else if(now-e.atkT>1100){e.atkT=now;tgt.health-=e.cropDmg;if(tgt.health<=0){tgt.stage=0;tgt.sinId=-1;tgt.health=100;}}}
    else{if(now-e.wT>2500){e.wT=now;const pts=[[1,4],[7,4],[13,4],[1,9],[7,9],[13,9],[7,6],[4,7]];const pt=pts[Math.random()*pts.length|0];e.wx=pt[0]*TS+24+(Math.random()-.5)*30;e.wy=pt[1]*TS+24+(Math.random()-.5)*30;}const d=Math.hypot(e.wx-e.x,e.wy-e.y);if(d>6){e.x+=(e.wx-e.x)/d*e.speed*0.5;e.y+=(e.wy-e.y)/d*e.speed*0.5;}}
    if(p.invTimer<=0&&Math.hypot(p.x-e.x,p.y-e.y)<22){p.hp-=e.pdmg;p.invTimer=1200;if(p.hp<=0){p.hp=0;p.dead=true;}}
  }
}
function updateSpawn(dt){
  gs.spawnT+=dt;const dc=discoveredCount(),iv=Math.max(7000,22000-dc*2000),mx=4+dc;
  if(gs.spawnT>iv&&gs.enemies.length<mx){gs.spawnT=0;const av=ETYPES.filter(t=>dc>=t.ulk);const tp=av[Math.random()*av.length|0];const pts=[[1,4],[14,4],[1,9],[14,9],[7,9]];const sp=pts[Math.random()*pts.length|0];gs.enemies.push({x:sp[0]*TS+24,y:sp[1]*TS+24,hp:tp.maxHp,maxHp:tp.maxHp,speed:tp.speed,reward:tp.reward,color:tp.color,size:tp.size,cropDmg:tp.cropDmg,pdmg:tp.pdmg,name:tp.name,atkT:0,wT:0,wx:0,wy:0,hit:0});}
}

// â”€â”€ Drawing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawTile(c,r){
  const x=c*TS,y=r*TS,t=MAP[r][c];
  if(t===3){ctx.fillStyle='#090705';ctx.fillRect(x,y,TS,TS);ctx.fillStyle='#0f0c08';ctx.fillRect(x+1,y+1,TS-2,TS-2);}
  else if(t===0){ctx.fillStyle='#0e0c08';ctx.fillRect(x,y,TS,TS);ctx.fillStyle='#100e09';for(let i=0;i<4;i++)ctx.fillRect(x+(c*7+i*13)%TS,y+(r*11+i*9)%TS,1,1);}
  else if(t===1){ctx.fillStyle='#1a1008';ctx.fillRect(x,y,TS,TS);ctx.fillStyle='#211408';ctx.fillRect(x+3,y+3,TS-6,TS-6);ctx.fillStyle='#180e06';ctx.fillRect(x+6,y+6,TS-12,TS-12);}
  else if(t===2){ctx.fillStyle='#130505';ctx.fillRect(x,y,TS,TS);}
}
function drawMap(){
  for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++)drawTile(c,r);
  // Shop building
  ctx.fillStyle='#1c0808';ctx.fillRect(TS,TS,3*TS,3*TS);
  ctx.strokeStyle='#6a0000';ctx.lineWidth=2;ctx.strokeRect(TS+1,TS+1,3*TS-2,3*TS-2);
  ctx.fillStyle='#6a0000';ctx.fillRect(TS+8,TS+8,3*TS-16,24);
  ctx.strokeStyle='#c8a020';ctx.lineWidth=1;ctx.strokeRect(TS+8,TS+8,3*TS-16,24);
  ctx.fillStyle='#c8a020';ctx.font='bold 9px Courier New';ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText('âšœ Ğ›ĞĞ’ĞšĞ Ğ“Ğ Ğ•Ğ¥ĞĞ’ âšœ',TS+1.5*TS,TS+20);
  for(const wx of[TS+10,TS+3*TS-26]){ctx.fillStyle='#0a0505';ctx.fillRect(wx,TS+36,16,16);ctx.strokeStyle='#3a1010';ctx.lineWidth=1;ctx.strokeRect(wx,TS+36,16,16);}
  const dx=TS+TS+12;ctx.fillStyle='#2a0a0a';ctx.fillRect(dx,3*TS+6,22,28);ctx.strokeStyle='#5a1818';ctx.lineWidth=1;ctx.strokeRect(dx,3*TS+6,22,28);
  ctx.fillStyle='#4a2020';ctx.font='9px Courier New';ctx.textAlign='center';ctx.textBaseline='alphabetic';ctx.fillText('[TAB]',TS+1.5*TS,4*TS+16);
  ctx.strokeStyle='rgba(60,35,10,0.22)';ctx.lineWidth=0.5;
  for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++)if(MAP[r][c]===1)ctx.strokeRect(c*TS,r*TS,TS,TS);
}
function drawPlots(){
  for(const pl of gs.plots){
    if(pl.stage===0)continue;
    const s=SINS[pl.sinId],px=pl.x*TS,py=pl.y*TS,cx=px+TS/2,cy=py+TS/2,hp=pl.health/100;
    if(hp<1){ctx.fillStyle=`rgba(160,0,0,${(1-hp)*0.4})`;ctx.fillRect(px,py,TS,TS);}
    if(pl.stage===1){ctx.fillStyle=s.dark;ctx.beginPath();ctx.ellipse(cx,cy+4,12,6,0,0,Math.PI*2);ctx.fill();ctx.fillStyle=s.color;ctx.beginPath();ctx.arc(cx,cy-2,6,0,Math.PI*2);ctx.fill();}
    else if(pl.stage===2){ctx.fillStyle=s.dark;ctx.fillRect(cx-12,cy-8,24,22);ctx.fillStyle=s.color;ctx.fillRect(cx-9,cy-16,18,18);ctx.fillStyle=s.glow;ctx.fillRect(cx-3,cy-18,6,6);}
    else{
      const pulse=0.65+0.35*Math.sin(gs.t/280);
      ctx.shadowColor=s.glow;ctx.shadowBlur=18*pulse;ctx.fillStyle=s.color;ctx.beginPath();ctx.arc(cx,cy,16,0,Math.PI*2);ctx.fill();
      ctx.shadowBlur=6;ctx.fillStyle=s.glow;ctx.beginPath();ctx.arc(cx,cy-2,9,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;
      ctx.font='15px serif';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(s.sym,cx,cy);ctx.textBaseline='alphabetic';
      ctx.fillStyle='#c8a020';ctx.font='bold 8px Courier New';ctx.fillText('[E]',cx,py+8);
    }
    ctx.fillStyle='rgba(120,80,40,0.7)';ctx.font='8px Courier New';ctx.textAlign='center';ctx.textBaseline='alphabetic';ctx.fillText(s.en.slice(0,5),cx,py+TS-4);
    if(hp<1){ctx.fillStyle='#300';ctx.fillRect(px+4,py+TS-9,TS-8,4);ctx.fillStyle='#c00';ctx.fillRect(px+4,py+TS-9,(TS-8)*hp,4);}
  }
}
function drawPlayer(){
  const p=gs.player;if(p.dead)return;
  if(p.invTimer>0&&Math.floor(Date.now()/80)%2)return;
  const x=p.x,y=p.y;
  const moving=joy.active||(keys['KeyA']||keys['KeyD']||keys['KeyW']||keys['KeyS']||keys['ArrowLeft']||keys['ArrowRight']||keys['ArrowUp']||keys['ArrowDown']);
  ctx.fillStyle='rgba(0,0,0,0.4)';ctx.beginPath();ctx.ellipse(x,y+12,14,5,0,0,Math.PI*2);ctx.fill();
  const lo=Math.sin(gs.t/80)*3;
  ctx.fillStyle='#151010';
  ctx.fillRect(x-7,y+6,6,moving?12+lo:12);ctx.fillRect(x+1,y+6,6,moving?12-lo:12);
  ctx.fillStyle='#1c1410';ctx.fillRect(x-9,y-14,18,22);
  ctx.fillStyle='#250a0a';ctx.fillRect(x-9,y-14,4,14);ctx.fillRect(x+5,y-14,4,14);
  ctx.fillStyle='#601010';ctx.fillRect(x-1,y-12,2,12);
  ctx.fillStyle='#1c1410';ctx.fillRect(x-12,y-14,4,6);ctx.fillRect(x+8,y-14,4,6);
  ctx.fillStyle='#b89050';ctx.fillRect(x-7,y-26,14,14);
  ctx.fillStyle='rgba(0,0,0,0.22)';ctx.fillRect(x-7,y-16,14,5);
  ctx.fillStyle='#0a0808';ctx.fillRect(x-11,y-28,22,5);
  ctx.fillStyle='#0d0a08';ctx.fillRect(x-7,y-40,14,14);
  ctx.fillStyle='#6a0000';ctx.fillRect(x-7,y-28,14,3);
  ctx.fillStyle='#c8a020';ctx.fillRect(x-5,y-22,3,3);ctx.fillRect(x+2,y-22,3,3);
  ctx.fillStyle='#c8c8a0';ctx.fillRect(x+7,y-18,8,2);
  ctx.fillStyle='#ff6020';ctx.shadowColor='#ff6020';ctx.shadowBlur=4;ctx.fillRect(x+15,y-19,3,3);ctx.shadowBlur=0;
  if(p.atkOn){
    const angles=[0,Math.PI/2,Math.PI,-Math.PI/2];
    ctx.save();ctx.translate(x,y);ctx.rotate(angles[p.facing]);
    ctx.fillStyle='#4a2005';ctx.fillRect(16,-3,28,6);ctx.fillStyle='#7a3a10';ctx.fillRect(40,-6,14,12);ctx.restore();
    ctx.strokeStyle='rgba(200,160,30,0.45)';ctx.lineWidth=1.5;ctx.beginPath();ctx.arc(x,y,46,0,Math.PI*2);ctx.stroke();
  } else {ctx.fillStyle='#4a2005';ctx.fillRect(x+9,y-8,5,22);ctx.fillStyle='#7a3a10';ctx.fillRect(x+8,y+12,7,8);}
}
function drawEnemy(e){
  const x=e.x,y=e.y,s=e.size,hit=Date.now()-e.hit<200,col=hit?'#fff':e.color;
  ctx.fillStyle='rgba(0,0,0,0.3)';ctx.beginPath();ctx.ellipse(x,y+s,s*0.8,s*0.3,0,0,Math.PI*2);ctx.fill();
  if(e.name==='Ğ“Ğ¾Ğ»ÑƒĞ±ÑŒ'){
    const wf=Math.sin(gs.t/120)*6;
    ctx.fillStyle=col;ctx.beginPath();ctx.ellipse(x,y,s,s*0.55,0,0,Math.PI*2);ctx.fill();
    ctx.beginPath();ctx.ellipse(x-s,y-3+wf,s*0.7,s*0.3,-0.3,0,Math.PI*2);ctx.fill();
    ctx.beginPath();ctx.ellipse(x+s,y-3-wf,s*0.7,s*0.3,0.3,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='#f0f0f0';ctx.beginPath();ctx.arc(x+s*.7,y-s*.4,s*.45,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='#c00';ctx.beginPath();ctx.arc(x+s+4,y-s*.4,2,0,Math.PI*2);ctx.fill();
  } else if(e.name==='Ğ¯Ğ³Ğ½Ñ‘Ğ½Ğ¾Ğº'){
    ctx.fillStyle=col;ctx.beginPath();ctx.arc(x,y,s,0,Math.PI*2);ctx.fill();
    ctx.fillStyle=hit?'#ddd':'#e0d4b0';
    for(let i=0;i<7;i++){const a=(i/7)*Math.PI*2;ctx.beginPath();ctx.arc(x+Math.cos(a)*s*.65,y+Math.sin(a)*s*.65,4,0,Math.PI*2);ctx.fill();}
    ctx.fillStyle=col;ctx.beginPath();ctx.arc(x+s*.8,y-s*.5,s*.5,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='#1a1010';ctx.fillRect(x+s*.9,y-s*.8,2,4);ctx.fillRect(x+s*1.1,y-s*.8,2,4);
  } else {
    ctx.fillStyle='rgba(160,190,240,0.35)';
    ctx.beginPath();ctx.ellipse(x-s*1.6,y-4,s,s*.55,-0.25,0,Math.PI*2);ctx.fill();
    ctx.beginPath();ctx.ellipse(x+s*1.6,y-4,s,s*.55,0.25,0,Math.PI*2);ctx.fill();
    ctx.fillStyle=col;ctx.beginPath();ctx.arc(x,y,s,0,Math.PI*2);ctx.fill();
    ctx.strokeStyle=hit?'#fff':'rgba(220,230,255,0.85)';ctx.lineWidth=2;ctx.beginPath();ctx.ellipse(x,y-s-4,s*.7,s*.22,0,0,Math.PI*2);ctx.stroke();
  }
  if(e.hp<e.maxHp){ctx.fillStyle='#300';ctx.fillRect(x-s,y+s+2,s*2,3);ctx.fillStyle='#c00';ctx.fillRect(x-s,y+s+2,s*2*(e.hp/e.maxHp),3);}
  ctx.fillStyle='rgba(200,170,130,0.65)';ctx.font='8px Courier New';ctx.textAlign='center';ctx.textBaseline='alphabetic';ctx.fillText(e.name,x,y-s-7);
}
function drawRain(){
  for(const d of gs.rain){ctx.strokeStyle=`rgba(130,160,210,${d.o})`;ctx.lineWidth=0.7;ctx.beginPath();ctx.moveTo(d.x,d.y);ctx.lineTo(d.x-2,d.y+d.l);ctx.stroke();d.y+=d.s;if(d.y>GH+d.l){d.y=-d.l;d.x=Math.random()*GW;}}
  const v=ctx.createRadialGradient(GW/2,GH/2,GH*.2,GW/2,GH/2,GH*.75);v.addColorStop(0,'transparent');v.addColorStop(1,'rgba(0,0,0,0.6)');ctx.fillStyle=v;ctx.fillRect(0,0,GW,GH);
}
function drawHUD(){
  ctx.fillStyle='rgba(4,2,1,0.95)';ctx.fillRect(0,0,GW,30);
  ctx.fillStyle='#c8a020';ctx.font='bold 13px Courier New';ctx.textAlign='left';ctx.textBaseline='middle';ctx.fillText('ğŸ’° '+gs.coins,8,15);
  const p=gs.player;ctx.fillStyle='#5a3030';ctx.font='10px Courier New';ctx.fillText('HP',180,15);
  for(let i=0;i<p.maxHp;i++){ctx.fillStyle=i<p.hp?'#c02020':'#281010';ctx.fillRect(205+i*14,7,11,11);}
  const dc=discoveredCount();
  ctx.fillStyle=dc===7?'#c8a020':'#5a3a2a';ctx.font=dc===7?'bold 11px Courier New':'10px Courier New';ctx.textAlign='center';
  ctx.fillText(dc===7?'âšœ Ğ’Ğ¡Ğ• ĞĞ¢ĞšĞ Ğ«Ğ¢Ğ« âšœ':'Ğ“Ğ Ğ•Ğ¥Ğ˜: '+dc+'/7',GW/2,15);
  for(let i=6;i>=0;i--){const x=GW-8-(6-i)*32;ctx.fillStyle=gs.discovered[i]?SINS[i].color:unlocked(i)?'#1a1210':'#0d0d0d';ctx.fillRect(x-26,4,24,22);ctx.strokeStyle=gs.discovered[i]?SINS[i].glow:'#2a1a10';ctx.lineWidth=1;ctx.strokeRect(x-26,4,24,22);ctx.font='13px serif';ctx.textAlign='center';ctx.textBaseline='middle';if(gs.discovered[i])ctx.fillText(SINS[i].sym,x-14,15);else if(unlocked(i)){ctx.fillStyle='#3a2818';ctx.font='10px Courier New';ctx.fillText('?',x-14,15);}else{ctx.fillStyle='#1a1010';ctx.fillText('âœ–',x-14,15);}}
  ctx.textBaseline='alphabetic';
  ctx.fillStyle='rgba(4,2,1,0.9)';ctx.fillRect(0,GH-28,GW,28);
  const ss=gs.player.sel,sinS=SINS[ss];
  ctx.fillStyle=unlocked(ss)?sinS.color:'#3a2a1a';ctx.font='bold 10px Courier New';ctx.textAlign='left';ctx.textBaseline='middle';
  ctx.fillText('â—† '+sinS.sym+' '+sinS.name+' (Ã—'+gs.seeds[ss]+')',8,GH-14);ctx.textBaseline='alphabetic';
}
function drawShop(){
  ctx.fillStyle='rgba(0,0,0,0.88)';ctx.fillRect(0,0,GW,GH);
  const sw=520,sh=422,sx=(GW-sw)/2,sy=(GH-sh)/2;
  ctx.fillStyle='#0c0404';ctx.fillRect(sx,sy,sw,sh);
  ctx.strokeStyle='#7a0000';ctx.lineWidth=2;ctx.strokeRect(sx,sy,sw,sh);
  ctx.fillStyle='#7a0000';ctx.fillRect(sx,sy,sw,34);ctx.strokeStyle='#c8a020';ctx.lineWidth=1;ctx.strokeRect(sx,sy,sw,34);
  ctx.fillStyle='#c8a020';ctx.font='bold 14px Courier New';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('âšœ  Ğ›ĞĞ’ĞšĞ Ğ¡Ğ•ĞœĞ¯Ğ Ğ“Ğ Ğ•Ğ¥Ğ  âšœ',sx+sw/2,sy+17);
  ctx.fillStyle='#c8a020';ctx.font='bold 12px Courier New';ctx.textAlign='left';ctx.textBaseline='alphabetic';ctx.fillText('ĞœĞ¾Ğ½ĞµÑ‚Ñ‹: '+gs.coins+'ğŸª™',sx+16,sy+sh-10);
  for(let i=0;i<7;i++){
    const row=sy+40+i*52,sel=gs.shop.sel===i,unl=unlocked(i);
    ctx.fillStyle=sel?'#1a0808':'#0e0505';ctx.fillRect(sx+8,row,sw-16,48);
    if(sel){ctx.strokeStyle='#7a0000';ctx.lineWidth=1;ctx.strokeRect(sx+8,row,sw-16,48);}
    ctx.fillStyle=unl?SINS[i].color:'#1a1010';ctx.fillRect(sx+16,row+8,30,32);
    ctx.font='17px serif';ctx.textAlign='center';ctx.textBaseline='middle';
    if(unl)ctx.fillText(SINS[i].sym,sx+31,row+24);else{ctx.fillStyle='#3a1a1a';ctx.fillText('ğŸ”’',sx+31,row+24);}
    if(!unl){ctx.fillStyle='#3a2020';ctx.font='10px Courier New';ctx.textAlign='left';ctx.textBaseline='alphabetic';ctx.fillText('ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Â«'+(SINS[i-1]?.name||'')+'Â» Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ',sx+56,row+26);continue;}
    ctx.fillStyle=gs.discovered[i]?SINS[i].glow:'#b09060';ctx.font='bold 12px Courier New';ctx.textAlign='left';ctx.textBaseline='alphabetic';ctx.fillText(SINS[i].name+' ('+SINS[i].en+')',sx+56,row+20);
    ctx.fillStyle='#6a5a4a';ctx.font='9px Courier New';ctx.fillText('Ğ¡ĞµĞ¼Ñ: '+SINS[i].seedCost+'ğŸª™  Ğ£Ñ€Ğ¾Ğ¶Ğ°Ğ¹: '+SINS[i].sellPrice+'ğŸª™  Ğ Ğ¾ÑÑ‚: '+SINS[i].growTime+'Ñ',sx+56,row+34);
    ctx.fillStyle=gs.discovered[i]?'#4a8a3a':'#5a4a3a';ctx.fillText(gs.discovered[i]?'âœ“ ĞĞ¢ĞšĞ Ğ«Ğ¢':'Ğ½Ğµ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚',sx+56,row+46);
    ctx.fillStyle='#c8a020';ctx.font='bold 14px Courier New';ctx.textAlign='right';ctx.textBaseline='middle';ctx.fillText('Ã—'+gs.seeds[i],sx+sw-20,row+24);
  }
  ctx.textBaseline='alphabetic';
}
function drawNotify(){
  if(!gs.notify)return;
  const d=gs.notify,sin=SINS[d.sinId],el=Date.now()-d.start;
  const a=el<400?el/400:el>3500?1-(el-3500)/500:1;
  ctx.save();ctx.globalAlpha=a;
  ctx.fillStyle='rgba(0,0,0,0.9)';ctx.fillRect(GW/2-210,GH/2-85,420,170);
  ctx.strokeStyle=sin.color;ctx.lineWidth=2;ctx.strokeRect(GW/2-210,GH/2-85,420,170);
  ctx.fillStyle='#5a4a3a';ctx.font='11px Courier New';ctx.textAlign='center';ctx.textBaseline='alphabetic';ctx.fillText('â—†â—†â—†  ĞĞĞ’Ğ«Ğ™ Ğ“Ğ Ğ•Ğ¥ ĞĞ¢ĞšĞ Ğ«Ğ¢  â—†â—†â—†',GW/2,GH/2-55);
  ctx.shadowColor=sin.glow;ctx.shadowBlur=22;ctx.fillStyle=sin.color;ctx.font='bold 26px Courier New';ctx.fillText(sin.sym+'  '+sin.name,GW/2,GH/2-10);ctx.shadowBlur=0;
  ctx.fillStyle='#7a6a5a';ctx.font='13px Courier New';ctx.fillText('"'+sin.en+'"',GW/2,GH/2+18);
  ctx.fillStyle='#4a3a2a';ctx.font='10px Courier New';ctx.fillText('Ğ¡ĞµĞ¼ĞµĞ½Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹ Ğ² Ğ»Ğ°Ğ²ĞºĞµ Ğ³Ñ€ĞµÑ…Ğ¾Ğ²',GW/2,GH/2+48);
  ctx.restore();
}
function drawDead(){
  ctx.fillStyle='rgba(0,0,0,0.82)';ctx.fillRect(0,0,GW,GH);
  ctx.shadowColor='#cc0000';ctx.shadowBlur=40;ctx.fillStyle='#8B0000';ctx.font='bold 52px Courier New';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('Ğ¢Ğ« ĞŸĞĞ›',GW/2,GH/2-40);ctx.shadowBlur=0;
  ctx.fillStyle='#4a2a2a';ctx.font='14px Courier New';ctx.fillText('Ğ¡Ñ‚Ñ€Ğ°Ğ¶Ğ¸ Ğ´Ğ¾Ğ±Ñ€Ğ¾Ğ´ĞµÑ‚ĞµĞ»Ğ¸ Ğ²Ğ·ÑĞ»Ğ¸ Ğ²ĞµÑ€Ñ…...',GW/2,GH/2+10);
  ctx.fillStyle='#2a1a1a';ctx.font='11px Courier New';ctx.fillText('ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾',GW/2,GH/2+50);ctx.textBaseline='alphabetic';
}
function drawWin(){
  ctx.fillStyle='rgba(0,0,0,0.92)';ctx.fillRect(0,0,GW,GH);
  ctx.shadowColor='#9030e0';ctx.shadowBlur=50;ctx.fillStyle='#5a0a90';ctx.font='bold 44px Courier New';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('Ğ’Ğ¡Ğ• 7 Ğ“Ğ Ğ•Ğ¥ĞĞ’',GW/2,GH/2-80);
  ctx.shadowBlur=10;ctx.fillStyle='#c8a020';ctx.font='bold 22px Courier New';ctx.fillText('ĞŸĞĞ—ĞĞĞĞ«',GW/2,GH/2-42);ctx.shadowBlur=0;
  ctx.fillStyle='#5a4a5a';ctx.font='12px Courier New';ctx.fillText('Ğ¢Ñ‹ Ğ·Ğ°Ğ³Ğ»ÑĞ½ÑƒĞ» Ğ² ÑĞ°Ğ¼ÑƒÑ Ñ‚ÑŒĞ¼Ñƒ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµÑ‡ĞµÑĞºĞ¾Ğ¹ Ğ´ÑƒÑˆĞ¸...',GW/2,GH/2);
  ctx.fillStyle='#c8a020';ctx.font='12px Courier New';ctx.fillText('ĞœĞ¾Ğ½ĞµÑ‚Ñ‹: '+gs.coins,GW/2,GH/2+28);
  SINS.forEach((s,i)=>{ctx.shadowColor=s.glow;ctx.shadowBlur=10;ctx.font='26px serif';ctx.fillText(s.sym,GW/2-90+i*30,GH/2+72);});
  ctx.shadowBlur=0;ctx.textBaseline='alphabetic';
}

// â”€â”€ Loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let last=0;
function loop(ts){
  const dt=Math.min(ts-last,100);last=ts;gs.t+=dt;
  if(!gs.player.dead&&!gs.win&&!gs.shop.open){updatePlayer(dt);updatePlots();updateEnemies();updateSpawn(dt);}
  ctx.fillStyle='#070503';ctx.fillRect(0,0,GW,GH);
  drawMap();drawPlots();
  for(const e of gs.enemies)drawEnemy(e);
  drawPlayer();drawRain();drawHUD();
  if(gs.shop.open)drawShop();
  if(gs.notify)drawNotify();
  if(gs.player.dead)drawDead();
  if(gs.win)drawWin();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
